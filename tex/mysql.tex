\documentclass[12pt,twiside,a4paper]{book}
\usepackage{feynmp} % 这个宏包可以用来在 LaTeX 中使用 MetaFont 图形元素
\usepackage{xeCJK} % 使用xeCJK处理中文
\usepackage{diagbox} % 使用 diagbox 宏包
\usepackage[centertags]{amsmath}
\usepackage{amsfonts}
\usepackage{amsthm}
\usepackage{newlfont}
\usepackage{makeidx}
\usepackage{wasysym}
\usepackage{geometry} 
\usepackage{graphics}
\usepackage{slashbox} 
\usepackage{fancyhdr} 
\usepackage[pdftex]{graphicx}
\usepackage{epstopdf}
\usepackage{cite}
\usepackage{listings}
\usepackage{tocbibind}
\usepackage{ulem} %
\usepackage{CJKutf8}
\usepackage[numbers,sort&compress]{natbib}
\usepackage{titlesec}

\setcounter{tocdepth}{8} % 生成目录层级
\setcounter{secnumdepth}{4}
\renewcommand\thesection{\arabic{section}}
\usepackage[pdfstartview=FitH,CJKbookmarks=true,bookmarks,bookmarksnumbered=true,
    colorlinks=true,citecolor=black,linkcolor=black,anchorcolor=green,urlcolor=black]{hyperref}
\titleformat{\chapter}[display]{\normalfont\huge\bfseries\center}{\chaptertitlename}{1pt}{\Huge}
\titleformat{\section}{\normalfont\Large\bfseries}{\thesection}{1em}{}
\titleformat{\subsection}{\normalfont\large\bfseries}{\thesubsection}{1em}{}
\titleformat{\subsubsection}{\normalfont\normalsize\bfseries}{\thesubsubsection}{1em}{}
\titleformat{\paragraph}[runin]{\normalfont\normalsize\bfseries}{\theparagraph}{1em}{}
\titleformat{\subparagraph}[runin]{\normalfont\normalsize\bfseries}{\thesubparagraph}{1em}{}
\titlespacing*{\chapter} {0pt}{10pt}{10pt}
\titlespacing*{\section} {0pt}{0.5ex plus 1ex minus .2ex}{0.3ex plus .2ex}
\titlespacing*{\subsection} {0pt}{0.25ex plus 1ex minus .1ex}{0.5ex plus .1ex}
\titlespacing*{\subsubsection}{0pt}{3.25ex plus 1ex minus .2ex}{1.5ex plus .2ex}
\titlespacing*{\paragraph} {0pt}{3.25ex plus 1ex minus .2ex}{1em}
\titlespacing*{\subparagraph} {\parindent}{3.25ex plus 1ex minus .2ex}{1em}
\numberwithin{chapter}{part}
\geometry{left=2.0cm,right=20mm,top=25mm,bottom=25mm}
\let\cleardoublepage\clearpage
\setlength\parskip{\baselineskip}

\usepackage{amssymb}
\usepackage{diagbox}
\usepackage{tipa}
\begin{document}

\author
{
%Peking University\\
%ShuwenHe\\
%1201220707@pku.edu.cn
}

\title{mysql}
\maketitle
\tableofcontents % 显示目录
\newpage
\pagestyle{fancy}

%\lhead{\includegraphics{sidsa.png}}
%\rhead{}
%\lfoot{}
%\rfoot{}
\section{}
\begin{lstlisting}[language=sql,breaklines = true]
grant all on *.* to root@'%' identified by 'sidsa!#123456!#';
\end{lstlisting}

\section{show}
\begin{lstlisting}[language=sql,breaklines = true]
show variables like 'port';
\end{lstlisting}
\section{design}
多对多：三张表，关系表两个外键。\\
一对多：两张表，多的表加外键。\\
一对一：外键唯一。

\section{host}
\begin{lstlisting}[language=sql,breaklines = true]
mysql -u root -p
use mysql;
select user,host from user;
update user set host = '%' where user='root';
flush privileges;
net stop mysql
net start mysql
\end{lstlisting}

\section{master slave}
在 MySQL 8.0 中设置主从复制(Master-Slave Replication)需要执行以下步骤:\\
\subsection{在主服务器上设置}
\subsubsection{编辑MySQL配置文件}
打开主服务器的MySQL配置文件(通常是 /etc/mysql/mysql.conf.d/mysqld.cnf )，并确保以下设置:\\
\begin{lstlisting}[language=sql,breaklines = true]
[mysqld]
server-id=1             # 服务器id (设置唯一标识)
log-bin=/var/log/mysql/mysql-bin.log # 打开日志
binlog_do_db = your_database_name
\end{lstlisting}
server-id是唯一的标识符，每个服务器都应有不同的ID。\\
log\_bin指定binlog日志的路径。\\
binlog\_do\_db指定要复制的数据库名，可以根据需求设置。
\subsection{重启MySQL服务}
sudo systemctl restart mysql
\subsection{创建用于复制的用户}
\begin{lstlisting}[language=sql,breaklines = true]
CREATE USER 'replication_user'@'slave_ip' IDENTIFIED BY 'password';
GRANT REPLICATION SLAVE ON *.* TO 'replication_user'@'slave_ip';
FLUSH PRIVILEGES;
\end{lstlisting}
替换 'replication\_user'、'slave\_ip' 和 'password' 为你自己的用户名、从服务器IP和密码。
\subsection{获取主服务器状态}
\begin{lstlisting}[language=sql,breaklines = true]
SHOW MASTER STATUS;
\end{lstlisting}
记下显示的文件名和位置，后面在从服务器设置时会用到。\\
\subsection{在从服务器上设置}
\subsubsection{编辑MySQL配置文件}
打开从服务器的MySQL配置文件，配置如下：\\
\begin{lstlisting}[language=sql,breaklines = true]
[mysqld]
server-id = 2
\end{lstlisting}
server-id是唯一的标识符，与主服务器不同即可。
\subsubsection{重启MySQL服务}
sudo systemctl restart mysql
\subsubsection{连接到主服务器}
在MySQL命令行中输入以下命令（替换 <master\_log\_file> 和 <position> 为主服务器的文件名和位置，这些信息是从主服务器上 SHOW MASTER STATUS; 获得的）：
\begin{lstlisting}[language=sql,breaklines = true]
CHANGE MASTER TO MASTER_HOST='master_ip', MASTER_USER='replication_user', MASTER_PASSWORD='password', MASTER_LOG_FILE='<master_log_file>', MASTER_LOG_POS=<position>;
\end{lstlisting}
替换 'master\_ip'、'replication\_user'、'password'、'<master\_log\_file>' 和 <position> 为你的主服务器IP、用户名、密码、主服务器的文件名和位置。
\subsubsection{启动从服务器复制}
\begin{lstlisting}[language=sql,breaklines = true]
START SLAVE;
\end{lstlisting}
\subsubsection{检查复制状态}
\begin{lstlisting}[language=sql,breaklines = true]
SHOW SLAVE STATUS \G;
\end{lstlisting}
确保 Slave\_IO\_Running 和 Slave\_SQL\_Running 均为 Yes，表示主从复制已成功启动。\\
完成这些步骤后，你的MySQL主从复制应该已经设置完成，主服务器上的更改会自动同步到从服务器。

\end{document}
